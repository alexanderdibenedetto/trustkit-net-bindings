# Xamarin.iOS and Xamarin.Android bindings
name: 1.0.0$(rev:.r)

trigger:
- main

pool:
  vmImage: 'macos-latest'

steps:
# To manually select a Xamarin SDK version on the Microsoft-hosted macOS agent,
# configure this task with the *Mono* version that is associated with the
# Xamarin SDK version that you need, and set the "enabled" property to true.
# See https://go.microsoft.com/fwlink/?linkid=871629
- script: sudo $AGENT_HOMEDIRECTORY/scripts/select-xamarin-sdk.sh 5_12_0
  displayName: 'Select the Xamarin SDK version'
  enabled: false

- checkout: self
  lfs: true

- task: NuGetToolInstaller@1

- task: MSBuild@1
  displayName: Restore TrustKit.Xamarin.Core for Android and Netstandard
  inputs:
    solution: src/TrustKit.Xamarin.Core/TrustKit.Xamarin.Core.csproj
    configuration: Release
    msbuildArguments: '/restore'

- task: MSBuild@1
  displayName: Build TrustKit.Xamarin.Core
  inputs:
    solution: src/TrustKit.Xamarin.Core/TrustKit.Xamarin.Core.csproj
    configuration: Release
    msbuildArguments: '/build'

- task: MSBuild@1
  displayName: Build TrustKit.Forms.iOS Project.
  inputs:
    solution: sample/TrustKit.Forms.iOS/TrustKit.Forms.iOS.csproj
    configuration: Release
    platform: iPhone
    msbuildArguments: '/restore /build'

- task: MSBuild@1
  displayName: Build TrustKit.Forms.Android Project.
  inputs:
    solution: sample/TrustKit.Forms.Android/TrustKit.Forms.Android.csproj
    configuration: Release
    msbuildArguments: '/restore /build'

- task: NuGetCommand@2
  inputs:
    command: 'pack'
    packagesToPack: '**/*.nuspec'
    versioningScheme: 'byBuildNumber'
    configuration: $(BuildConfiguration)

- task: NuGetCommand@2
  inputs:
    command: 'push'
    packagesToPush: '$(Build.ArtifactStagingDirectory)/**/*.nupkg;!$(Build.ArtifactStagingDirectory)/**/*.symbols.nupkg'
    nuGetFeedType: 'internal'
    publishVstsFeed: '3d84ee8c-75d6-468d-83a1-d08e5e070e1d'
